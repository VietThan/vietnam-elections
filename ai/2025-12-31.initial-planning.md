# Vietnam Elections Candidate Directory Site (Static, GitHub Pages) — Engineering Plan

## Goals
- Build a **static** website (GitHub Pages) that **indexes official candidate information** for Vietnam elections.
- Support **multiple election cycles** (e.g., `na-2026`, `na-2021`) and optionally cross-cycle **people** pages.
- Keep legal/political risk low by operating in **“encyclopedia mode”**:
  - No endorsements, no rankings, no allegations, no user comments/forums.
  - Every factual field is backed by a **source link** and **timestamp**.
  - Public change logs + transparent methodology.

---

## High-level Architecture
- **Data pipeline** (runs locally and in GitHub Actions)
  1) Ingest official sources (HTML/PDF) → `raw_sources/`
  2) Normalize into **SQLite staging DB** (`staging.db`)
  3) Export JSON datasets for the site into `src/data/...`

- **Static site** (Next.js static export)
  - `next build` (with `output: "export"`) → `out/`
  - Deploy `out/` to GitHub Pages via GitHub Actions

---


---

## Sitemap (multi-cycle)
- `/{lang}/` — home (spotlight “current cycle”)
- `/{lang}/elections` — list of cycles
- `/{lang}/elections/{cycle}` — overview

Cycle-scoped core:
- `/{lang}/elections/{cycle}/candidates`
- `/{lang}/elections/{cycle}/candidates/{entry}`
- `/{lang}/elections/{cycle}/localities`
- `/{lang}/elections/{cycle}/localities/{locality}`
- `/{lang}/elections/{cycle}/constituencies`
- `/{lang}/elections/{cycle}/constituencies/{constituency}`
- `/{lang}/elections/{cycle}/timeline`
- `/{lang}/elections/{cycle}/documents`
- `/{lang}/elections/{cycle}/changelog`

Cross-cycle (optional):
- `/{lang}/people`
- `/{lang}/people/{person}`

Risk-reducers:
- `/{lang}/methodology`
- `/{lang}/sources`
- `/{lang}/corrections` (private intake form only)
- `/{lang}/disclaimer`
- `/{lang}/privacy`
- `/{lang}/terms`
- `/{lang}/contact`

---

## Static Search (no backend)
### Approach
- Build-time export produces a small `candidates_index.json` per cycle.
- `/candidates` page loads the index and filters client-side.
- Use accent-insensitive matching via **folded fields** generated at build time.

### Index record shape (example)
```json
{
  "entry_id": "na-2026-000123",
  "person_id": "p-9f3c1a2b",
  "name_vi": "Nguyễn Văn A",
  "name_folded": "nguyen van a",
  "locality_id": "hanoi",
  "locality_vi": "Hà Nội",
  "locality_folded": "ha noi",
  "office": "National Assembly",
  "constituency_id": "na-2026-hanoi-01",
  "constituency_vi": "Hà Nội - Đơn vị bầu cử số 1",
  "last_updated": "2026-02-01",
  "sources_count": 3
}
```

## Notes

- If indexes get large: chunk by locality (`indexes/{locality_id}.json`) and load on demand.
- Later upgrade path: build FlexSearch index at build time for ranking/typos.

---

## Next.js (GitHub Pages) Configuration
- Use static export + basePath/assetPrefix for GitHub Pages
- Disable Next Image optimization (required for export)

```js
const repo = process.env.GITHUB_REPOSITORY?.split("/")[1] || "";
const isProd = process.env.NODE_ENV === "production";

module.exports = {
  output: "export",
  trailingSlash: true,
  basePath: isProd ? `/${repo}` : "",
  assetPrefix: isProd ? `/${repo}/` : "",
  images: { unoptimized: true },
};
```

---

## Data Pipeline: SQLite Staging (build artifact)

### Rationale
- Simplifies joins/deduping across cycles (people ↔ entries ↔ constituencies ↔ sources)
- Enforces integrity via constraints (unique keys, FKs)
- Enables QA queries (“missing sources”, “duplicate people”)
- Still no ops: DB is recreated in CI/local each run

### Minimal schema (start small)

**Tables**:
- `election_cycle(cycle_id, type, year, election_day, updated_at)`
- `locality(locality_id, name_vi, name_folded)`
- `constituency(constituency_id, cycle_id, locality_id, name_vi, seats)`
- `person(person_id, name_vi, name_folded)`
- `candidate_entry(entry_id, cycle_id, person_id, office, locality_id, constituency_id, bio_vi, photo_url, last_seen_at, last_updated_at)`
- `source(source_id, entry_id, field, title, url, published_at, fetched_at)`
- `document(doc_id, cycle_id, locality_id, constituency_id, title, url, published_at, fetched_at)`

**Constraints**:
- `candidate_entry.entry_id` unique
- `person.name_folded` not necessarily unique; prefer deterministic `person_id` based on (name_folded + locality + other official identifiers if available)
- source unique on (`entry_id, field, url`) to prevent duplicates
- Foreign keys enabled

**ID strategy**
- `cycle_id`: string like `na-2026`
- `entry_id`: `${cycle_id}-${sequence_or_hash}`
- `person_id`: stable hash of canonicalized identifiers (e.g., folded name + dob if official + maybe locality)
- `locality_id` and `constituency_id`: stable slugs; consider per-cycle constituency IDs because boundaries may change

---

## Export JSON Shapes

Per cycle:
- `elections/{cycle}/candidates_index.json` (for search/listing)
- `elections/{cycle}/candidates_detail/{entry_id}.json` (full detail page payload)
- `elections/{cycle}/localities.json`
- `elections/{cycle}/constituencies.json`
- `elections/{cycle}/timeline.json`
- `elections/{cycle}/documents.json`
- `elections/{cycle}/changelog.json`

Cross-cycle (optional):
- `people/people_index.json`
- `people/people_detail/{person_id}.json` (links to entries across cycles)

---

## QA / Integrity Checks (must-have)

Run in CI after staging build:

- No candidate entry without at least one source:
    - `SELECT entry_id FROM candidate_entry e LEFT JOIN source s ON s.entry_id=e.entry_id WHERE s.entry_id IS NULL;`
- No broken FKs (person/locality/constituency)
- Duplicate detection heuristics:
    - same name_folded within same cycle+locality (flag for review)
- Missing key fields:
    - `bio_vi IS NULL`, `constituency_id IS NULL`, etc.
- Changelog generation sanity:
    - verify diffs computed from previous `staging.db` snapshot (optional)

---

## Risk / Policy Guardrails (content + product)

- No comments, no user profiles, no public submissions.
- No endorsements, rankings, “best candidate”, sentiment, allegations, or rumor aggregation.
- Every page shows:
    - “Last updated”
    - “Sources” (links + dates)
    - “Change history”
- Corrections page is private intake only; not a forum.
- Avoid collecting personal data (no accounts); minimal analytics or none.

---

## Implementation Milestones

### Milestone 0 — Skeleton

- Next.js static export to GitHub Pages working (hello world)
- BasePath/assetPrefix correct

### Milestone 1 — Single cycle directory (JSON-only OK)

- Manually curated na-2026 JSON (small set)
- List page + detail page + client-side search

### Milestone 2 — Add SQLite staging

- Build staging.db from raw inputs
- Export JSON shapes from SQL
- Add QA checks

### Milestone 3 — Multi-cycle support

- Add na-2021 dataset
- Elections index page + per-cycle pages

### Milestone 4 — Optional people pages

- Create person table and stable IDs
- `people_index.json` + `people/{person}` pages

### Milestone 5 — Hardening

- Methodology + sources registry + changelog pages
- Locality/constituency chunked indexes if needed
- Accessibility + performance polish

---

## Engineering Notes
- Keep site content strictly derived from official sources; store citation metadata per field.
- Prefer build-time accent folding + slug normalization.
- Use SQLite as a build artifact to reduce code complexity for joins and integrity checks.
- Avoid over-modeling early; start with minimal schema and grow only when exports/queries demand it.